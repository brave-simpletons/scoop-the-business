{
    "version": "122.0.5643.105",
    "description": "Opera GX is a special version of the Opera browser built specifically for gamers.",
    "homepage": "https://www.opera.com/gx",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.opera.com/eula/computers"
    },
    "architecture": {
        "64bit": {
            "url": "https://get.opera.com/pub/opera_gx/122.0.5643.105/win/Opera_GX_122.0.5643.105_Setup_x64.exe#/dl.7z",
            "hash": "a7fc88c16003665366aad5ffd2434a3e6da2f0da8f9862707cbfcd8948857c70"
        },
        "32bit": {
            "url": "https://get.opera.com/pub/opera_gx/122.0.5643.105/win/Opera_GX_122.0.5643.105_Setup.exe#/dl.7z",
            "hash": "2eccbddda1599d40fe30bdd9014fff15f56a905b9eb96ff559b6691b2cebf99c"
        }
    },
    "pre_install": [
        "$operagx_root = \"$dir\".Replace('\\', '\\\\')",
        "'install-context.reg', 'uninstall-context.reg' | ForEach-Object {",
        "    $content = Get-Content \"$bucketsdir\\business\\assets\\opera-gx\\$_\"",
        "    $content = $content.Replace('$operagx_root', $operagx_root)",
        "    if ($global) {",
        "       $content = $content.Replace('HKEY_CURRENT_USER', 'HKEY_LOCAL_MACHINE')",
        "    }",
        "    Set-Content \"$dir\\$_\" $content -Encoding Ascii",
        "}"
    ],
    "installer": {
        "script": [
            "Remove-Item -Path \"$dir\\*_list\" -Force",
            "if (!(Test-Path \"$dir\\localization\")) {",
            "   New-Item -Path \"$dir\\localization\" -ItemType Directory | Out-Null",
            "   Move-Item -Path \"$dir\\*.pak\" -Destination \"$dir\\localization\" -Exclude 'opera*' -ErrorAction Ignore",
            "}",
            "Set-Content -Path \"$dir\\installer_prefs.json\" -Value (@{ 'autoupdate'= $false; 'enable_stats' = $false; 'single_profile' = $true } | ConvertTo-Json) -Encoding ASCII"
        ]
    },
    "post_install": [
        "reg import \"$dir\\install-context.reg\"",
        "Write-Host Registering the app with : \"$dir\\install-context.reg\""
    ],
    "uninstaller": {
        "script": [
            "reg import \"$dir\\uninstall-context.reg\"",
            "Write-Host UnRegistering the app with : \"$dir\\uninstall-context.reg\""
        ]
    },
    "bin": [
        [
            "opera.exe",
            "Opera GX",
            "--user-data-dir=$persist_dir\\profile\\data"
        ]
    ],
    "shortcuts": [
        [
            "opera.exe",
            "Opera GX",
            "--user-data-dir=$persist_dir\\profile\\data"
        ]
    ],
    "persist": "profile",
    "checkver": {
        "script": [
            "$releases = 'https://get.opera.com/pub/opera_gx/'",
            "$download_page = Invoke-WebRequest -Uri $releases -UseBasicParsing",
            "$versionSort   = { [version]$_.href.TrimEnd('/') }",
            "$last_ver = $download_page.links | Where-Object href -match '^[\\d]+[\\d\\.]+/$' | Sort-Object $versionSort -Descending | Select-Object -first 1 -expand href",
            "$version = $last_ver -replace '/', ''",
            "Write-Output $version"
        ],
        "regex": "(\\S+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://get.opera.com/pub/opera_gx/$version/win/Opera_GX_$version_Setup_x64.exe#/dl.7z"
            },
            "32bit": {
                "url": "https://get.opera.com/pub/opera_gx/$version/win/Opera_GX_$version_Setup.exe#/dl.7z"
            }
        },
        "hash": {
            "url": "$url.sha256sum"
        }
    }
}
